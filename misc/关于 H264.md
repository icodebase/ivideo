#### H264压制视频

输入文件一，模板中选择 Video ( h264 ) ，输出选项会自动设置好，点击 Run ，粘贴编码，等待压制完成即可。

 

#### 选项帮助：

##### 输出文件选项：

-c:v 设置视频编码器，-c:v libx264 表示使用 libx264 编码器输出 h264 编码的视频

-crf 恒定视频质量的参数，-crf 23 表示输出视频质量为 crf 23 。

-preset 压制速度，可选项：ultrafast, superfast, veryfast, faster, fast, medium, slow, slower, veryslow, placebo

-qcomp 量化曲线压缩因子（Quantizer curve compression factor）

-psy-rd 用 psy-rd:psy-trellis 的格式设置 心理视觉优化强度（ strength of psychovisual optimization, in psy-rd:psy-trellis format）

-aq-mode 设置 AQ 方法，可选值为：

- none (*0*) 帧内宏块全部使用同一或者固定的表
- variance (*1*) 使用方差动态计算每个宏块的
- autovariance (*2*) 方差自适应模式，会先遍历一次全部宏块，统计出一些中间参数，之后利用这些参数，对每个宏块计算 

-aq-strength 设置 AQ 强度，在平面和纹理区域 减少 方块和模糊。

 **以上所有参数你都可以手工修改，以达到需要的视频质量和体积**

 

#### 注意事项

注意，压制视频的话，输入文件放一个就行了哈，别放两个输入，FFmpeg 会自动把最高分辨率的视频流和声道数最多的音频流合并输出的。

 

#### 相关科普

压制过程中你可以从命令行看到实时压制速度、总码率、体积、压制到视频几分几秒了。

相关解释：H264是一个很成熟的视频编码格式，兼容性也很好，一般你所见到的视频多数都是这个编码，小白压制视频无脑选这个就行了。

这个参数下，画质和体积能得到较好的平衡，一般能把手机相机拍摄的视频压制到原来体积的1/3左右，甚至更小，画质也没有明显的损失。

但是注意，**自己录制的视频**压缩率很低，压制后会有很好的效果，从**视频网站下载的**电影、电视剧就**不要再压制**了，人家一集视频，都是已经用**性能拔尖的服务器**使用**最费时**、**压缩率最高**的参数压制了**几小时甚至几天**的，压缩率已经到了极致了，再让你用手上的设备解码重新压制一下，体积可能**不减反增**。

控制视频大小有两种方法：

- 恒定画面质量，可变码率。也就是 crf 方式

  这时，编码器会根据你要求的画面质量，自动分配码率，给复杂的画面部分多分配点码率，给简单的画面少分配点码率，可以得到画面质量均一的输出视频，这是最推荐的压制方式。不过无法准确预测输出文件的大小。假如你的视频全程都是非常复杂、包含大量背景运动的画面，那么可能压制出来的视频，比原视频还要大。这里的压制方式用的就是 恒定画面质量 的方式。

- 恒定码率

  这时，编码器会根据你的要求，给每一秒都分配相同的码率，可以准确预测输出文件的大小。但是，由于码率恒定，可能有些复杂的片段，你分配的码率不够用，就会画质下降，有些静态部分多的画面，就浪费了很多码率，所以一般不推荐用。如果你想用这个方案，请参阅 控制码率压制视频 

针对恒定码率的缺点，有个改进方案就是 2-pass （二压），详见 h264 二压视频（两次操作） 

此处输出选项里的 -crf 23 是画质控制参数。取值 0 - 51 ，越小画质越高，同时体积越大。 0 代表无损画质，体积超大。一般认为， -crf 18 的时候，人眼就几乎无法看出画质有损失了，大于 -crf 28 的时候，人眼就开始看到比较明显的画质损失。没有特殊要求的话，默认用 -crf 23 就行了。压制画质要求很高的视频就用 -crf 18 。

此处输出选项里的 -preset medium 代表压制编码速度适中，可选值有 ultrafast, superfast, veryfast, faster, fast, medium, slow, slower, veryslow, placebo ，设置越慢，压制时间越长，画质控制越出色，设置越快，信息丢失就越严重，图像质量越差。

为什么 placebo 是纯粹的浪费时间？ 

相同码率下，相比于 veryslow，placebo 只提升不到 1% 的视频质量（同样码率下），但消耗非常多的时间。veryslow 比 slower 提升 3% ； slower 比 slow 提升 5% ，slow 比 medium 提升 5%-10% 。

相同码率下，相较于 medium：slow 编码所需时间增加大约 40% ；到 slower 增加大约 100% ，到 veryslow 增加大约 280% 。

相同码率下，相较于 medium ： fast 节约 10% 编码时间； faster 节约 25% ； ultrafast 节约 55%（但代价是更低的画质）

如果你的原视频是 rgb 像素格式的，建议使用 -c:v libx264rgb ，来避免转化成 yuv420 时的画质损失。